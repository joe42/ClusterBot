<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developers documentation &mdash; Clusterbot v0.7 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Clusterbot v0.7 documentation" href="index.html" />
    <link rel="next" title="The ClusterBot Module" href="ClusterBot.html" />
    <link rel="prev" title="Setup documentation" href="setup.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="ClusterBot.html" title="The ClusterBot Module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="setup.html" title="Setup documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Clusterbot v0.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="developers-documentation">
<h1>Developers documentation<a class="headerlink" href="#developers-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="extensions">
<h2>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h2>
<p>There are two distinct kind of extensions. First of all there are commands and secondly there are events. Both extensions can be described by XML files.
These files can then be converted to Python modules by using the XMLEventParser and XMLCommandParser, respectively.
Afterwards they can be loaded during runtime, by calling either <em>importnewevents</em> or <em>importnewcommands</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To make things short, the notion &#8220;TAG-ATTRIBUTE&#8221; is used as an abbreviation for
&#8220;the value of the attribute with the name ATTRIBUTE belonging to the tag with the name TAG&#8221;.</p>
</div>
<div class="section" id="command-extensions">
<h3>Command Extensions<a class="headerlink" href="#command-extensions" title="Permalink to this headline">¶</a></h3>
<p>Command Extensions allow for additional commands which can be issued through the XMPP client.</p>
<p>The first step to create a command extension is to write a XML file like the following:
.. highlight::xml</p>
<p><strong>batchqueues.xml</strong>:</p>
<div class="highlight-python"><pre>&lt;commandmodule&gt;
  &lt;command name="batchqueues"&gt;
    &lt;description desc="Displays an overview of the Batch SystemQueues."/&gt;
    &lt;cmd cmd="/usr/local/maui/bin/showq"&gt;
        &lt;message text="$result"/&gt;
    &lt;/cmd&gt;
  &lt;/command&gt;
&lt;/commandmodule&gt;</pre>
</div>
<p>The first important value is the command-name, which on the one hand side will be used as the resulting Python module&#8217;s name and
on the other hand side will be the command&#8217;s name, which can be used to invoke the command via the XMPP client.
Secondly there is the description-desc, which states the description, which can be viewed by the client command <em>listcommands</em>.
Thirdly, there is the cmd-cmd, which specifies the shell command to be executed on the headnode by invoking <em>command-name</em> on the client.
Last but not least, the message-text attribute declares the string which is send as a reply to the client invoking the command.
Words with a preceding $-Sign like the <em>$result</em> will be replaced. <em>$result</em> is a special variable, which is replaced by the output of the
executed shell command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Commands results are cached for about one minute.</p>
</div>
<p>After storing the XML file as <em>/path/file.xml</em> the XMLCommandParser module will be used to convert the XML file to the actual Python module.
Therefore one needs to navigate to the parent folder of the package clusterbot. From there a Python console can be invoked.
The following commands need to be issued in the Python  shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">clusterbot.commands.XMLCommandParser</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">createCommandFromFile</span><span class="p">(</span><span class="s">&quot;/path/file.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively a python script could be created to automate the task:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/bin/python</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">clusterbot.commands.XMLCommandParser</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">createCommandFromFile</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>This could be called with:</p>
<p><strong>./scriptname.py</strong> <em>&#8220;/path/file.xml&#8221;</em></p>
</div>
<div class="section" id="event-extensions">
<h3>Event Extensions<a class="headerlink" href="#event-extensions" title="Permalink to this headline">¶</a></h3>
<p>Event extensions allow for new event modules which can keep the client up-to-date about something, without requiring active requests.</p>
<p>An event can be subscribed to by the <em>subscribe EVENTNAME</em> command through the XMPP client.</p>
<p>The first step to create an event extension is to write a XML file like the following:
.. highlight::xml</p>
<p><strong>ExceedingCPUTempEvent2.xml</strong>:</p>
<div class="highlight-python"><pre>&lt;eventmodule&gt;
  &lt;event name="ExceedingCPUTempEvent2" is="CachedEvent"&gt;
    &lt;description desc="An exceedingly obvious testing stub."/&gt;
    &lt;param name="x" default="0" type="int"/&gt;
    &lt;command cmd="sensors"&gt;
        &lt;regex name="cputemp" type="int" regex="(\d+).?.?.?.?C"/&gt;
        &lt;test test="cputemp &gt; 90"/&gt;
        &lt;message text="CPU temperature hit critical limit: $cputemp\n"/&gt;
    &lt;/command&gt;
  &lt;/event&gt;
&lt;/eventmodule&gt;</pre>
</div>
<p>The first important value is the event-name, which on the one hand side will be used as the resulting Python module&#8217;s name and
on the other hand side will be the event&#8217;s name, which can be used to for subscription via the XMPP client.
Secondly there is the description-desc, which states the description, which can be viewed by the client command <em>listevents</em>.
The param Tag take following three attributes. The name attribute specifies a variable name, default states the variables default value and type
is the type of the variable, which is one of &#8220;int&#8221; or &#8220;str&#8221;. There can be several param Tags, but param-name needs to be unique.
command-cmd specifies the shell command to be executed on the headnode.
Within the command tag there is an arbitrary number of regex and test Tags. regex-name again specifies a variable with the type specified in regex-type.
regex-type can again have a value of &#8220;int&#8221; or &#8220;str&#8221;. regex-regex is a regular expression. The first group, marked by parenthesis, determine the value of the
variable. Therefore the regular expression is searched for in each line of the result of the executed command-cmd. regex-type needs to correspond to the matched group.
Now the test-test is evaluated. Inside test-test, which is a boolean expression in Python syntax, the regex - variables as well as the param - variables can be used.
The message-text attribute declares the string which is send as a reply to the client invoking the command. The message is generated once for each line of the
resulting output of the executed command-cmd, if all regular expressions match the line and all tests return True.
Words with a preceding $-Sign like the <em>$result</em> will be replaced. <em>$result</em> is a special variable, which is replaced by the output of the
executed shell command. All regex and param - values can be used as well, but one needs to be sure of preceding their names by the $-Sign.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Event messages are cached for about one minute.</p>
</div>
<p>After storing the XML file as <em>/path/file.xml</em> the XMLEventParser module will be used to convert the XML file to the actual Python module.
Therefore one needs to navigate to the parent folder of the package clusterbot. From there a Python console can be invoked.
The following commands need to be issued in the Python  shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">clusterbot.commands.XMLEventParser</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">createEventFromFile</span><span class="p">(</span><span class="s">&quot;/path/file.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively a python script could be created to automate the task:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/bin/python</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">clusterbot.commands.XMLEventParser</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">createEventFromFile</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>This could be called with:</p>
<p><strong>./scriptname.py</strong> <em>&#8220;/path/file.xml&#8221;</em></p>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>To generate this documentation call:</p>
<blockquote>
<ol class="arabic simple">
<li><strong>clusterbot/doc/generate_modules.py</strong> <em class="xref">-d</em> <em>clusterbot/doc</em> <em class="xref">-f</em> <em class="xref">-m</em> 5 clusterbot clusterbot/xmpp  clusterbot/jabberbot.py clusterbot/blowfish.py*</li>
<li><strong>make</strong> <em class="xref">-f</em> <em>clusterbot/doc/Makefile html</em></li>
</ol>
</blockquote>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>To run all tests call:
<strong>python</strong> <em class="xref">-m</em> <em>clusterbot.tests.main</em></p>
</div>
<div class="section" id="modules">
<h2>Modules:<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<ul>
<li class="toctree-l1"><a class="reference external" href="ClusterBot.html">The <tt class="docutils literal"><span class="pre">ClusterBot</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="EventDrivenShellClusterBot.html">The <tt class="docutils literal"><span class="pre">EventDrivenShellClusterBot</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="ShellClusterBot.html">The <tt class="docutils literal"><span class="pre">ShellClusterBot</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="commandmodules.html">The <tt class="docutils literal"><span class="pre">batchqueues</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="commandmodules.html#module-clusterbot.commandmodules.memoryusage">The <tt class="docutils literal"><span class="pre">memoryusage</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="commandmodules.html#module-clusterbot.commandmodules.networkusage">The <tt class="docutils literal"><span class="pre">networkusage</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="commands.html">The <tt class="docutils literal"><span class="pre">XMLCommandParser</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="eventmodules.html">The <tt class="docutils literal"><span class="pre">ExceedingCPUTempEvent2</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="eventmodules.html#module-clusterbot.eventmodules.ExceedingCPUTempEvent">The <tt class="docutils literal"><span class="pre">ExceedingCPUTempEvent</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="events.html">The <tt class="docutils literal"><span class="pre">Event</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="events.html#module-clusterbot.events.CachedEvent">The <tt class="docutils literal"><span class="pre">CachedEvent</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="events.html#the-eventfactory-module">The <tt class="docutils literal"><span class="pre">EventFactory</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="events.html#module-clusterbot.events.XMLEventParser">The <tt class="docutils literal"><span class="pre">XMLEventParser</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="main.html">The <tt class="docutils literal"><span class="pre">main</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="shell.html">The <tt class="docutils literal"><span class="pre">myconsole</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="ssh.html">The <tt class="docutils literal"><span class="pre">ssh</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html">The <tt class="docutils literal"><span class="pre">EventDrivenShellClusterBotTest</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html#module-clusterbot.tests.test">The <tt class="docutils literal"><span class="pre">test</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html#module-clusterbot.tests.ShellClusterBotTest">The <tt class="docutils literal"><span class="pre">ShellClusterBotTest</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html#module-clusterbot.tests.XMLParserTest">The <tt class="docutils literal"><span class="pre">XMLParserTest</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html#module-clusterbot.tests.MyXMLReaderTest">The <tt class="docutils literal"><span class="pre">MyXMLReaderTest</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="tests.html#module-clusterbot.tests.stringtest">The <tt class="docutils literal"><span class="pre">stringtest</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="util.html">The <tt class="docutils literal"><span class="pre">string</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="util.html#module-clusterbot.util.ClassBuilder">The <tt class="docutils literal"><span class="pre">ClassBuilder</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="util.html#module-clusterbot.util.timer">The <tt class="docutils literal"><span class="pre">timer</span></tt> Module</a></li>
<li class="toctree-l1"><a class="reference external" href="util.html#module-clusterbot.util.MyXMLReader">The <tt class="docutils literal"><span class="pre">MyXMLReader</span></tt> Module</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Developers documentation</a><ul>
<li><a class="reference external" href="#extensions">Extensions</a><ul>
<li><a class="reference external" href="#command-extensions">Command Extensions</a></li>
<li><a class="reference external" href="#event-extensions">Event Extensions</a></li>
</ul>
</li>
<li><a class="reference external" href="#documentation">Documentation</a></li>
<li><a class="reference external" href="#tests">Tests</a></li>
<li><a class="reference external" href="#modules">Modules:</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="setup.html"
                                  title="previous chapter">Setup documentation</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="ClusterBot.html"
                                  title="next chapter">The <tt class="docutils literal docutils literal docutils literal"><span class="pre">ClusterBot</span></tt> Module</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/develop.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ClusterBot.html" title="The ClusterBot Module"
             >next</a> |</li>
        <li class="right" >
          <a href="setup.html" title="Setup documentation"
             >previous</a> |</li>
        <li><a href="index.html">Clusterbot v0.7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2011, Johannes Müller.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>